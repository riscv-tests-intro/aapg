stages:
  - test
#   - deploy

before_script:
    - source /tools/setup.sh
    - export PYTHONPATH=$(pwd)
    - export PATH="/home/lavanya/.pyenv/bin:$PATH"
    - eval "$(pyenv init -)"
    - eval "$(pyenv virtualenv-init -)"
    - pyenv activate py37
    - git pull
    - git checkout 80-tohost-align-fix
    - pip install pytest
    - pip install pytest-timeout
    - pip uninstall -y aapg
    - python setup.py install
test:
    script:
        - pytest tests/test_aapg.py -m "serial" -v
        - pytest tests/test_aapg.py -n 10 -m "not serial" -v --seed=$((1 + $RANDOM))

    tags:
        - mathsya-shakti

# deploy:
#     stage: deploy
#     script:
#         - source /tools/setup.sh
#         - export PYTHONPATH=$(pwd)
#         - export PATH="/home/lavanya/.pyenv/bin:$PATH"
#         - eval "$(pyenv init -)"
#         - eval "$(pyenv virtualenv-init -)"
#         - pyenv activate py37
#         - pip install twine
#         - python setup.py sdist
#         - python -m twine upload --username $shaktipypiusername --password $shaktipypipassword dist/*
# #        - python /scratch/version-extract-rst.py
#     only:
#         refs:
#             - master
#     tags:
#         - mathsya-shakti


